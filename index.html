<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Download Gate</title>
</head>
<body>

<h2 id="status">Checking access…</h2>

<script>
// ===== LOGIN CODES (Hardcoded in HTML) =====
const FREE_CODE = "FREE123";
const VIP_CODES = ["iPZ6","VIP999","VIP888"];

// ===== SHEET JSON URL =====
const SHEET_JSON = "https://docs.google.com/spreadsheets/d/1dcKugmmNcr4Uu4RZFOP8PxZSRt-nQpqQUlrF4P9ck8Q/gviz/tq?tqx=out:json";

const code = new URLSearchParams(location.search).get("code");

if(!code){
  status.innerText = "Please add ?code= in URL";
  throw "";
}

fetch(SHEET_JSON)
.then(res => res.text())
.then(txt => {
  // strip Google gviz prefix
  const json = JSON.parse(txt.substring(47).slice(0, -2));
  const rows = json.table.rows;

  let vipLink="";
  let freeLink="";

  // loop through sheet rows
  for(let r of rows){
    const c = r.c;
    const sheetCode = c[0] ? c[0].v : "";
    const sheetVip  = c[1] ? c[1].v : "";
    const sheetFree = c[2] ? c[2].v : "";

    if(sheetCode === code){
      vipLink = sheetVip;
      freeLink= sheetFree;
      break;
    }
  }

  if(code === FREE_CODE && freeLink){
    status.innerText = "Free Access ✔ Redirecting…";
    setTimeout(()=> location.href = freeLink, 1000);
  }
  else if(VIP_CODES.includes(code) && vipLink){
    status.innerText = "VIP Access ✔ Redirecting…";
    setTimeout(()=> location.href = vipLink, 1000);
  }
  else{
    status.innerText = "Invalid Code or Link Not Found ❌";
  }
});
</script>

</body>
</html>
